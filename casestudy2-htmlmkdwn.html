<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Matt Sherga" />


<title>Case Study 2 DDS</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">My Website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="B-B-Case-Study.html">Case Study 1</a>
</li>
<li>
  <a href="casestudy2-htmlmkdwn.html">Case Study 2</a>
</li>
<li>
  <a href="About-Me.html">About</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Case Study 2 DDS</h1>
<h4 class="author">Matt Sherga</h4>
<h4 class="date">8/15/2020</h4>

</div>


<p><a href="https://youtu.be/lnrLYs5pkfc" title="Youtube Video">Watch my presentation</a></p>
<div id="description" class="section level2">
<h2>Description:</h2>
<div class="line-block">      DDSAnalytics has requested an analysis of employee data with the intent to decrease the rate of attrition, as well as form a model for predicting attrition, and another model for predicting monthly income based on whatever factors are found to be influential. Additional analysis is welcome.</div>
<div class="line-block">      Analyze existing employee data at DDSAnalytics to:</div>
<ol style="list-style-type: decimal">
<li>Predict employee Attrition<br />
</li>
<li>Identify any Job-Role specific trends<br />
</li>
<li>Determine the top three most influential factors that contribute to Attrition<br />
</li>
<li>Establish criteria for predicting monthly income, and create a regression model</li>
</ol>
</div>
<div id="process" class="section level2">
<h2>Process:</h2>
<div class="line-block">      First, the data was cleaned and organized. There were no missing values, and the data was comprised of both categorical and continuous variables. The categories “EmployeeCount”, “Over18”, and “StandardHours” all only had one level so they were removed from the data.</div>
<div class="line-block">      Next, the mean of each continuous variable, and a frequency bar chart for categories, were plotted according to Job Role. Sales Representatives are, on average, the youngest, live closest to work, the lowest monthly income, fewest working years, and fewest years at the company. When looking at attrition, you can see that they also have the highest rate of departures compared to any other job role (almost 50%). If you take a look at business travel, a substantial percentage of sales reps travel frequently when compared to other roles. Sales representatives make up a relatively small portion of the Sales department, especially when compared to Sales Executives. This may be due to the higher rate of attrition in that role, but at a lower income it seems like you might get value at accelerating hiring of this role.</div>
<div class="line-block">      Environment Satisfaction scores were mostly evenly distributed within and across every job role. You also look to have good gender diversity across all job roles, although research scientists and lab techs look to be slightly higher percentage male, as does human resources.</div>
<div class="line-block">      The data was heavily skewed toward “No” for attrition, so it was randomly subsampled to compare with less bias. A best seed was found for creating test and train samples, and Naïve Bayes was run on the data. It was found that the top three highest probability Attrition factors are employees who Travel Rarely (conditional prob = .68), Stock Option level of 0 (cp = .71), and performance rating of 3 (cp = .85). The model we created had an accuracy of .833, Sensitivity of .871, and Specificity of .800 when run against the test set. When used to predict attrition for the competition data, the outcome was again heavily skewed toward “no” attrition. So if that data sample is representative of our starting dataset, this reinforces our model.</div>
<div class="line-block">      For our second model, we set out to determine what factors can be used to predict monthly income. Again, the data was split into a training and test set, and this time we ran linear regression against all variables. An ANOVA was run to determine what variables are significant predictors in our model. We then re-ran the regression, and ANOVA until all our predictors had significant p-values &lt; .05. Age, Attrition, Business Travel, Department, Education, EducationField, EnvironmentSatisfaction, Gender, JobInvolvement, JobLevel, and JobRole were all deemed significant in our model. Each had a p-value &lt;.001 except for business travel with a .008. The model was run against the test set, the train set, and the full dataset to receive respective RMSE values of $1200.83, $973.09, and $1064.57. We then created residual plots for each of these, and see that the data is randomly scattered along the zero line with no influential points. Finally, density plots were compared between the predictions on the competition sets, and on the downsampled data. They have very similar shapes, which reinforces the strength of the model.</div>
<pre class="r"><code># Load the libraries in R 
library(MASS)
library(ggplot2)
library(dplyr)
library(e1071)
library(caret)
library(psych) 
library(Amelia)#missmap for graphing missing values
library(broom) #tidy
library(DescTools)
library(car) #outliertest
library(readxl)
library(knitr)#nicer tables for ppt
library(rminer)#variable importance for NB
library(rms)
library(GGally)
library(tidyverse)</code></pre>
</div>
<div id="eda-how-does-the-dataset-look" class="section level1">
<h1>EDA How does the dataset look?</h1>
<div id="no-missing-values" class="section level3">
<h3>No missing values</h3>
</div>
<div id="employeenumber-was-not-removed-because-i-do-not-know-if-there-is-a-system-to-assigning-them.-it-may-have-some-meaning-im-unaware-of." class="section level3">
<h3>EmployeeNumber was not removed because I do not know if there is a system to assigning them. It may have some meaning I’m unaware of.</h3>
<pre class="r"><code># Set global seed. Load the dataset from the file system and convert appropriate columns to factors, and remove factors with only one level.
set.seed(123)

df1 &lt;- read.csv(&quot;CaseStudy2-data.csv&quot;)
#any missing data? no
missmap(df1)</code></pre>
<p><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
</div>
<div id="what-data-is-categorical" class="section level1">
<h1>What data is categorical?</h1>
<pre class="r"><code>#learn more about it
str(df1)</code></pre>
<pre><code>## &#39;data.frame&#39;:    870 obs. of  36 variables:
##  $ ID                      : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Age                     : int  32 40 35 32 24 27 41 37 34 34 ...
##  $ Attrition               : chr  &quot;No&quot; &quot;No&quot; &quot;No&quot; &quot;No&quot; ...
##  $ BusinessTravel          : chr  &quot;Travel_Rarely&quot; &quot;Travel_Rarely&quot; &quot;Travel_Frequently&quot; &quot;Travel_Rarely&quot; ...
##  $ DailyRate               : int  117 1308 200 801 567 294 1283 309 1333 653 ...
##  $ Department              : chr  &quot;Sales&quot; &quot;Research &amp; Development&quot; &quot;Research &amp; Development&quot; &quot;Sales&quot; ...
##  $ DistanceFromHome        : int  13 14 18 1 2 10 5 10 10 10 ...
##  $ Education               : int  4 3 2 4 1 2 5 4 4 4 ...
##  $ EducationField          : chr  &quot;Life Sciences&quot; &quot;Medical&quot; &quot;Life Sciences&quot; &quot;Marketing&quot; ...
##  $ EmployeeCount           : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ EmployeeNumber          : int  859 1128 1412 2016 1646 733 1448 1105 1055 1597 ...
##  $ EnvironmentSatisfaction : int  2 3 3 3 1 4 2 4 3 4 ...
##  $ Gender                  : chr  &quot;Male&quot; &quot;Male&quot; &quot;Male&quot; &quot;Female&quot; ...
##  $ HourlyRate              : int  73 44 60 48 32 32 90 88 87 92 ...
##  $ JobInvolvement          : int  3 2 3 3 3 3 4 2 3 2 ...
##  $ JobLevel                : int  2 5 3 3 1 3 1 2 1 2 ...
##  $ JobRole                 : chr  &quot;Sales Executive&quot; &quot;Research Director&quot; &quot;Manufacturing Director&quot; &quot;Sales Executive&quot; ...
##  $ JobSatisfaction         : int  4 3 4 4 4 1 3 4 3 3 ...
##  $ MaritalStatus           : chr  &quot;Divorced&quot; &quot;Single&quot; &quot;Single&quot; &quot;Married&quot; ...
##  $ MonthlyIncome           : int  4403 19626 9362 10422 3760 8793 2127 6694 2220 5063 ...
##  $ MonthlyRate             : int  9250 17544 19944 24032 17218 4809 5561 24223 18410 15332 ...
##  $ NumCompaniesWorked      : int  2 1 2 1 1 1 2 2 1 1 ...
##  $ Over18                  : chr  &quot;Y&quot; &quot;Y&quot; &quot;Y&quot; &quot;Y&quot; ...
##  $ OverTime                : chr  &quot;No&quot; &quot;No&quot; &quot;No&quot; &quot;No&quot; ...
##  $ PercentSalaryHike       : int  11 14 11 19 13 21 12 14 19 14 ...
##  $ PerformanceRating       : int  3 3 3 3 3 4 3 3 3 3 ...
##  $ RelationshipSatisfaction: int  3 1 3 3 3 3 1 3 4 2 ...
##  $ StandardHours           : int  80 80 80 80 80 80 80 80 80 80 ...
##  $ StockOptionLevel        : int  1 0 0 2 0 2 0 3 1 1 ...
##  $ TotalWorkingYears       : int  8 21 10 14 6 9 7 8 1 8 ...
##  $ TrainingTimesLastYear   : int  3 2 2 3 2 4 5 5 2 3 ...
##  $ WorkLifeBalance         : int  2 4 3 3 3 2 2 3 3 2 ...
##  $ YearsAtCompany          : int  5 20 2 14 6 9 4 1 1 8 ...
##  $ YearsInCurrentRole      : int  2 7 2 10 3 7 2 0 1 2 ...
##  $ YearsSinceLastPromotion : int  0 4 2 5 1 1 0 0 0 7 ...
##  $ YearsWithCurrManager    : int  3 9 2 7 3 7 3 0 0 7 ...</code></pre>
<pre class="r"><code>describe(df1)</code></pre>
<pre><code>## df1 
## 
##  36  Variables      870  Observations
## --------------------------------------------------------------------------------
## ID 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      870        0      870        1    435.5    290.3    44.45    87.90 
##      .25      .50      .75      .90      .95 
##   218.25   435.50   652.75   783.10   826.55 
## 
## lowest :   1   2   3   4   5, highest: 866 867 868 869 870
## --------------------------------------------------------------------------------
## Age 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      870        0       43    0.999    36.83    10.07       24       26 
##      .25      .50      .75      .90      .95 
##       30       35       43       50       54 
## 
## lowest : 18 19 20 21 22, highest: 56 57 58 59 60
## --------------------------------------------------------------------------------
## Attrition 
##        n  missing distinct 
##      870        0        2 
##                       
## Value         No   Yes
## Frequency    730   140
## Proportion 0.839 0.161
## --------------------------------------------------------------------------------
## BusinessTravel 
##        n  missing distinct 
##      870        0        3 
##                                                                 
## Value             Non-Travel Travel_Frequently     Travel_Rarely
## Frequency                 94               158               618
## Proportion             0.108             0.182             0.710
## --------------------------------------------------------------------------------
## DailyRate 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      870        0      627        1    815.2    463.3    175.4    257.8 
##      .25      .50      .75      .90      .95 
##    472.5    817.5   1165.8   1368.0   1436.7 
## 
## lowest :  103  111  117  119  120, highest: 1490 1495 1496 1498 1499
## --------------------------------------------------------------------------------
## Department 
##        n  missing distinct 
##      870        0        3 
##                                                                                
## Value             Human Resources Research &amp; Development                  Sales
## Frequency                      35                    562                    273
## Proportion                  0.040                  0.646                  0.314
## --------------------------------------------------------------------------------
## DistanceFromHome 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      870        0       29    0.993    9.339    8.843      1.0      1.0 
##      .25      .50      .75      .90      .95 
##      2.0      7.0     14.0     23.1     26.0 
## 
## lowest :  1  2  3  4  5, highest: 25 26 27 28 29
## --------------------------------------------------------------------------------
## Education 
##        n  missing distinct     Info     Mean      Gmd 
##      870        0        5    0.917    2.901     1.12 
## 
## lowest : 1 2 3 4 5, highest: 1 2 3 4 5
##                                         
## Value          1     2     3     4     5
## Frequency     98   182   324   240    26
## Proportion 0.113 0.209 0.372 0.276 0.030
## --------------------------------------------------------------------------------
## EducationField 
##        n  missing distinct 
##      870        0        6 
## 
## lowest : Human Resources  Life Sciences    Marketing        Medical          Other           
## highest: Life Sciences    Marketing        Medical          Other            Technical Degree
##                                                                               
## Value       Human Resources    Life Sciences        Marketing          Medical
## Frequency                15              358              100              270
## Proportion            0.017            0.411            0.115            0.310
##                                             
## Value                 Other Technical Degree
## Frequency                52               75
## Proportion            0.060            0.086
## --------------------------------------------------------------------------------
## EmployeeCount 
##        n  missing distinct     Info     Mean      Gmd 
##      870        0        1        0        1        0 
##               
## Value        1
## Frequency  870
## Proportion   1
## --------------------------------------------------------------------------------
## EmployeeNumber 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      870        0      870        1     1030    698.6     86.9    191.1 
##      .25      .50      .75      .90      .95 
##    477.2   1039.0   1561.5   1856.2   1958.3 
## 
## lowest :    1    4   11   13   14, highest: 2041 2053 2056 2062 2064
## --------------------------------------------------------------------------------
## EnvironmentSatisfaction 
##        n  missing distinct     Info     Mean      Gmd 
##      870        0        4     0.93    2.701     1.22 
##                                   
## Value          1     2     3     4
## Frequency    172   178   258   262
## Proportion 0.198 0.205 0.297 0.301
## --------------------------------------------------------------------------------
## Gender 
##        n  missing distinct 
##      870        0        2 
##                         
## Value      Female   Male
## Frequency     354    516
## Proportion  0.407  0.593
## --------------------------------------------------------------------------------
## HourlyRate 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      870        0       71        1    65.61    23.24       34       39 
##      .25      .50      .75      .90      .95 
##       48       66       83       94       97 
## 
## lowest :  30  31  32  33  34, highest:  96  97  98  99 100
## --------------------------------------------------------------------------------
## JobInvolvement 
##        n  missing distinct     Info     Mean      Gmd 
##      870        0        4    0.775    2.723   0.7042 
##                                   
## Value          1     2     3     4
## Frequency     47   228   514    81
## Proportion 0.054 0.262 0.591 0.093
## --------------------------------------------------------------------------------
## JobLevel 
##        n  missing distinct     Info     Mean      Gmd 
##      870        0        5    0.896    2.039    1.139 
## 
## lowest : 1 2 3 4 5, highest: 1 2 3 4 5
##                                         
## Value          1     2     3     4     5
## Frequency    329   312   132    60    37
## Proportion 0.378 0.359 0.152 0.069 0.043
## --------------------------------------------------------------------------------
## JobRole 
##        n  missing distinct 
##      870        0        9 
## 
## lowest : Healthcare Representative Human Resources           Laboratory Technician     Manager                   Manufacturing Director   
## highest: Manufacturing Director    Research Director         Research Scientist        Sales Executive           Sales Representative     
## 
## Healthcare Representative (76, 0.087), Human Resources (27, 0.031), Laboratory
## Technician (153, 0.176), Manager (51, 0.059), Manufacturing Director (87,
## 0.100), Research Director (51, 0.059), Research Scientist (172, 0.198), Sales
## Executive (200, 0.230), Sales Representative (53, 0.061)
## --------------------------------------------------------------------------------
## JobSatisfaction 
##        n  missing distinct     Info     Mean      Gmd 
##      870        0        4    0.929    2.709    1.236 
##                                   
## Value          1     2     3     4
## Frequency    179   166   254   271
## Proportion 0.206 0.191 0.292 0.311
## --------------------------------------------------------------------------------
## MaritalStatus 
##        n  missing distinct 
##      870        0        3 
##                                      
## Value      Divorced  Married   Single
## Frequency       191      410      269
## Proportion    0.220    0.471    0.309
## --------------------------------------------------------------------------------
## MonthlyIncome 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      870        0      826        1     6390     4757     2088     2279 
##      .25      .50      .75      .90      .95 
##     2840     4946     8182    13571    17165 
## 
## lowest :  1081  1091  1102  1118  1129, highest: 19845 19859 19926 19943 19999
## --------------------------------------------------------------------------------
## MonthlyRate 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      870        0      852        1    14326     8210     3456     4751 
##      .25      .50      .75      .90      .95 
##     8092    14074    20456    24045    25541 
## 
## lowest :  2094  2104  2112  2125  2137, highest: 26862 26933 26959 26968 26997
## --------------------------------------------------------------------------------
## NumCompaniesWorked 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      870        0       10    0.945    2.728    2.683        0        0 
##      .25      .50      .75      .90      .95 
##        1        2        4        7        8 
## 
## lowest : 0 1 2 3 4, highest: 5 6 7 8 9
##                                                                       
## Value          0     1     2     3     4     5     6     7     8     9
## Frequency    111   320    74    91    85    43    39    46    28    33
## Proportion 0.128 0.368 0.085 0.105 0.098 0.049 0.045 0.053 0.032 0.038
## --------------------------------------------------------------------------------
## Over18 
##        n  missing distinct    value 
##      870        0        1        Y 
##               
## Value        Y
## Frequency  870
## Proportion   1
## --------------------------------------------------------------------------------
## OverTime 
##        n  missing distinct 
##      870        0        2 
##                     
## Value        No  Yes
## Frequency   618  252
## Proportion 0.71 0.29
## --------------------------------------------------------------------------------
## PercentSalaryHike 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      870        0       15    0.988     15.2    4.047       11       11 
##      .25      .50      .75      .90      .95 
##       12       14       18       21       22 
## 
## lowest : 11 12 13 14 15, highest: 21 22 23 24 25
##                                                                             
## Value         11    12    13    14    15    16    17    18    19    20    21
## Frequency    126   119   123   120    54    43    56    57    40    27    33
## Proportion 0.145 0.137 0.141 0.138 0.062 0.049 0.064 0.066 0.046 0.031 0.038
##                                   
## Value         22    23    24    25
## Frequency     30    17    14    11
## Proportion 0.034 0.020 0.016 0.013
## --------------------------------------------------------------------------------
## PerformanceRating 
##        n  missing distinct     Info     Mean      Gmd 
##      870        0        2    0.386    3.152   0.2577 
##                       
## Value          3     4
## Frequency    738   132
## Proportion 0.848 0.152
## --------------------------------------------------------------------------------
## RelationshipSatisfaction 
##        n  missing distinct     Info     Mean      Gmd 
##      870        0        4    0.929    2.707    1.223 
##                                   
## Value          1     2     3     4
## Frequency    174   171   261   264
## Proportion 0.200 0.197 0.300 0.303
## --------------------------------------------------------------------------------
## StandardHours 
##        n  missing distinct     Info     Mean      Gmd 
##      870        0        1        0       80        0 
##               
## Value       80
## Frequency  870
## Proportion   1
## --------------------------------------------------------------------------------
## StockOptionLevel 
##        n  missing distinct     Info     Mean      Gmd 
##      870        0        4    0.848   0.7839   0.8749 
##                                   
## Value          0     1     2     3
## Frequency    379   355    81    55
## Proportion 0.436 0.408 0.093 0.063
## --------------------------------------------------------------------------------
## TotalWorkingYears 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      870        0       39    0.995    11.05    8.048        1        3 
##      .25      .50      .75      .90      .95 
##        6       10       15       22       26 
## 
## lowest :  0  1  2  3  4, highest: 34 35 36 37 40
## --------------------------------------------------------------------------------
## TrainingTimesLastYear 
##        n  missing distinct     Info     Mean      Gmd 
##      870        0        7    0.909    2.832    1.341 
## 
## lowest : 0 1 2 3 4, highest: 2 3 4 5 6
##                                                     
## Value          0     1     2     3     4     5     6
## Frequency     30    39   309   308    73    75    36
## Proportion 0.034 0.045 0.355 0.354 0.084 0.086 0.041
## --------------------------------------------------------------------------------
## WorkLifeBalance 
##        n  missing distinct     Info     Mean      Gmd 
##      870        0        4    0.759    2.782   0.7045 
##                                   
## Value          1     2     3     4
## Frequency     48   192   532    98
## Proportion 0.055 0.221 0.611 0.113
## --------------------------------------------------------------------------------
## YearsAtCompany 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      870        0       32    0.993    6.962    6.208        1        1 
##      .25      .50      .75      .90      .95 
##        3        5       10       15       20 
## 
## lowest :  0  1  2  3  4, highest: 30 31 32 33 40
## --------------------------------------------------------------------------------
## YearsInCurrentRole 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      870        0       19    0.973    4.205    3.967        0        0 
##      .25      .50      .75      .90      .95 
##        2        3        7        9       11 
## 
## lowest :  0  1  2  3  4, highest: 14 15 16 17 18
##                                                                             
## Value          0     1     2     3     4     5     6     7     8     9    10
## Frequency    151    38   223    68    53    26    17   136    56    40    14
## Proportion 0.174 0.044 0.256 0.078 0.061 0.030 0.020 0.156 0.064 0.046 0.016
##                                                           
## Value         11    12    13    14    15    16    17    18
## Frequency     15     7     9     7     3     3     3     1
## Proportion 0.017 0.008 0.010 0.008 0.003 0.003 0.003 0.001
## --------------------------------------------------------------------------------
## YearsSinceLastPromotion 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      870        0       16    0.923    2.169    2.961        0        0 
##      .25      .50      .75      .90      .95 
##        0        1        3        7        9 
## 
## lowest :  0  1  2  3  4, highest: 11 12 13 14 15
##                                                                             
## Value          0     1     2     3     4     5     6     7     8     9    10
## Frequency    342   214    94    32    32    30    23    41    12     9     4
## Proportion 0.393 0.246 0.108 0.037 0.037 0.034 0.026 0.047 0.014 0.010 0.005
##                                         
## Value         11    12    13    14    15
## Frequency     14     5     5     5     8
## Proportion 0.016 0.006 0.006 0.006 0.009
## --------------------------------------------------------------------------------
## YearsWithCurrManager 
##        n  missing distinct     Info     Mean      Gmd      .05      .10 
##      870        0       17    0.976     4.14    3.938        0        0 
##      .25      .50      .75      .90      .95 
##        2        3        7        9       10 
## 
## lowest :  0  1  2  3  4, highest: 12 13 14 15 17
##                                                                             
## Value          0     1     2     3     4     5     6     7     8     9    10
## Frequency    166    40   202    76    51    22    12   131    68    44    18
## Proportion 0.191 0.046 0.232 0.087 0.059 0.025 0.014 0.151 0.078 0.051 0.021
##                                               
## Value         11    12    13    14    15    17
## Frequency     11    13     7     4     1     4
## Proportion 0.013 0.015 0.008 0.005 0.001 0.005
## --------------------------------------------------------------------------------</code></pre>
<pre class="r"><code>summary(df1) #need to convert all character and scales to factors, and remove ID column.</code></pre>
<pre><code>##        ID             Age         Attrition         BusinessTravel    
##  Min.   :  1.0   Min.   :18.00   Length:870         Length:870        
##  1st Qu.:218.2   1st Qu.:30.00   Class :character   Class :character  
##  Median :435.5   Median :35.00   Mode  :character   Mode  :character  
##  Mean   :435.5   Mean   :36.83                                        
##  3rd Qu.:652.8   3rd Qu.:43.00                                        
##  Max.   :870.0   Max.   :60.00                                        
##    DailyRate       Department        DistanceFromHome   Education    
##  Min.   : 103.0   Length:870         Min.   : 1.000   Min.   :1.000  
##  1st Qu.: 472.5   Class :character   1st Qu.: 2.000   1st Qu.:2.000  
##  Median : 817.5   Mode  :character   Median : 7.000   Median :3.000  
##  Mean   : 815.2                      Mean   : 9.339   Mean   :2.901  
##  3rd Qu.:1165.8                      3rd Qu.:14.000   3rd Qu.:4.000  
##  Max.   :1499.0                      Max.   :29.000   Max.   :5.000  
##  EducationField     EmployeeCount EmployeeNumber   EnvironmentSatisfaction
##  Length:870         Min.   :1     Min.   :   1.0   Min.   :1.000          
##  Class :character   1st Qu.:1     1st Qu.: 477.2   1st Qu.:2.000          
##  Mode  :character   Median :1     Median :1039.0   Median :3.000          
##                     Mean   :1     Mean   :1029.8   Mean   :2.701          
##                     3rd Qu.:1     3rd Qu.:1561.5   3rd Qu.:4.000          
##                     Max.   :1     Max.   :2064.0   Max.   :4.000          
##     Gender            HourlyRate     JobInvolvement     JobLevel    
##  Length:870         Min.   : 30.00   Min.   :1.000   Min.   :1.000  
##  Class :character   1st Qu.: 48.00   1st Qu.:2.000   1st Qu.:1.000  
##  Mode  :character   Median : 66.00   Median :3.000   Median :2.000  
##                     Mean   : 65.61   Mean   :2.723   Mean   :2.039  
##                     3rd Qu.: 83.00   3rd Qu.:3.000   3rd Qu.:3.000  
##                     Max.   :100.00   Max.   :4.000   Max.   :5.000  
##    JobRole          JobSatisfaction MaritalStatus      MonthlyIncome  
##  Length:870         Min.   :1.000   Length:870         Min.   : 1081  
##  Class :character   1st Qu.:2.000   Class :character   1st Qu.: 2840  
##  Mode  :character   Median :3.000   Mode  :character   Median : 4946  
##                     Mean   :2.709                      Mean   : 6390  
##                     3rd Qu.:4.000                      3rd Qu.: 8182  
##                     Max.   :4.000                      Max.   :19999  
##   MonthlyRate    NumCompaniesWorked    Over18            OverTime        
##  Min.   : 2094   Min.   :0.000      Length:870         Length:870        
##  1st Qu.: 8092   1st Qu.:1.000      Class :character   Class :character  
##  Median :14074   Median :2.000      Mode  :character   Mode  :character  
##  Mean   :14326   Mean   :2.728                                           
##  3rd Qu.:20456   3rd Qu.:4.000                                           
##  Max.   :26997   Max.   :9.000                                           
##  PercentSalaryHike PerformanceRating RelationshipSatisfaction StandardHours
##  Min.   :11.0      Min.   :3.000     Min.   :1.000            Min.   :80   
##  1st Qu.:12.0      1st Qu.:3.000     1st Qu.:2.000            1st Qu.:80   
##  Median :14.0      Median :3.000     Median :3.000            Median :80   
##  Mean   :15.2      Mean   :3.152     Mean   :2.707            Mean   :80   
##  3rd Qu.:18.0      3rd Qu.:3.000     3rd Qu.:4.000            3rd Qu.:80   
##  Max.   :25.0      Max.   :4.000     Max.   :4.000            Max.   :80   
##  StockOptionLevel TotalWorkingYears TrainingTimesLastYear WorkLifeBalance
##  Min.   :0.0000   Min.   : 0.00     Min.   :0.000         Min.   :1.000  
##  1st Qu.:0.0000   1st Qu.: 6.00     1st Qu.:2.000         1st Qu.:2.000  
##  Median :1.0000   Median :10.00     Median :3.000         Median :3.000  
##  Mean   :0.7839   Mean   :11.05     Mean   :2.832         Mean   :2.782  
##  3rd Qu.:1.0000   3rd Qu.:15.00     3rd Qu.:3.000         3rd Qu.:3.000  
##  Max.   :3.0000   Max.   :40.00     Max.   :6.000         Max.   :4.000  
##  YearsAtCompany   YearsInCurrentRole YearsSinceLastPromotion
##  Min.   : 0.000   Min.   : 0.000     Min.   : 0.000         
##  1st Qu.: 3.000   1st Qu.: 2.000     1st Qu.: 0.000         
##  Median : 5.000   Median : 3.000     Median : 1.000         
##  Mean   : 6.962   Mean   : 4.205     Mean   : 2.169         
##  3rd Qu.:10.000   3rd Qu.: 7.000     3rd Qu.: 3.000         
##  Max.   :40.000   Max.   :18.000     Max.   :15.000         
##  YearsWithCurrManager
##  Min.   : 0.00       
##  1st Qu.: 2.00       
##  Median : 3.00       
##  Mean   : 4.14       
##  3rd Qu.: 7.00       
##  Max.   :17.00</code></pre>
<pre class="r"><code>dfsubset &lt;- df1[,2:33]

factorcolumns&lt;- c(&quot;BusinessTravel&quot;, &quot;Department&quot;, &quot;Education&quot;, &quot;EducationField&quot;, &quot;EnvironmentSatisfaction&quot;, &quot;Gender&quot;, &quot;JobInvolvement&quot;, &quot;JobLevel&quot;, &quot;JobRole&quot;, &quot;JobSatisfaction&quot;, &quot;MaritalStatus&quot;,  &quot;NumCompaniesWorked&quot;, &quot;OverTime&quot;, &quot;PerformanceRating&quot;, &quot;RelationshipSatisfaction&quot;,  &quot;StockOptionLevel&quot;, &quot;TrainingTimesLastYear&quot;, &quot;WorkLifeBalance&quot;)</code></pre>
<pre class="r"><code>kable(factorcolumns, col.names = &quot;Factor Variables&quot;)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Factor Variables</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">BusinessTravel</td>
</tr>
<tr class="even">
<td align="left">Department</td>
</tr>
<tr class="odd">
<td align="left">Education</td>
</tr>
<tr class="even">
<td align="left">EducationField</td>
</tr>
<tr class="odd">
<td align="left">EnvironmentSatisfaction</td>
</tr>
<tr class="even">
<td align="left">Gender</td>
</tr>
<tr class="odd">
<td align="left">JobInvolvement</td>
</tr>
<tr class="even">
<td align="left">JobLevel</td>
</tr>
<tr class="odd">
<td align="left">JobRole</td>
</tr>
<tr class="even">
<td align="left">JobSatisfaction</td>
</tr>
<tr class="odd">
<td align="left">MaritalStatus</td>
</tr>
<tr class="even">
<td align="left">NumCompaniesWorked</td>
</tr>
<tr class="odd">
<td align="left">OverTime</td>
</tr>
<tr class="even">
<td align="left">PerformanceRating</td>
</tr>
<tr class="odd">
<td align="left">RelationshipSatisfaction</td>
</tr>
<tr class="even">
<td align="left">StockOptionLevel</td>
</tr>
<tr class="odd">
<td align="left">TrainingTimesLastYear</td>
</tr>
<tr class="even">
<td align="left">WorkLifeBalance</td>
</tr>
</tbody>
</table>
</div>
<div id="can-any-variables-be-confidently-removed" class="section level1">
<h1>Can any variables be confidently removed?</h1>
<div id="one-level-employeecount-over18-standardhours" class="section level2">
<h2>One level: EmployeeCount, Over18, StandardHours</h2>
<pre class="r"><code>dfsubset[,factorcolumns] &lt;- lapply(df1[,factorcolumns], as.factor)
dffactors &lt;- dfsubset %&gt;% mutate_if(is.character,as.factor)
#found factors with only one level. so these can be removed as they are not useful.
kable(sapply(dffactors, function(vals) length(unique(vals))), col.names = &quot;Levels&quot;) #returns the count of unique values in each column. </code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">Levels</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Age</td>
<td align="right">43</td>
</tr>
<tr class="even">
<td>Attrition</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td>BusinessTravel</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td>DailyRate</td>
<td align="right">627</td>
</tr>
<tr class="odd">
<td>Department</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td>DistanceFromHome</td>
<td align="right">29</td>
</tr>
<tr class="odd">
<td>Education</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td>EducationField</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td>EmployeeCount</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td>EmployeeNumber</td>
<td align="right">870</td>
</tr>
<tr class="odd">
<td>EnvironmentSatisfaction</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td>Gender</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td>HourlyRate</td>
<td align="right">71</td>
</tr>
<tr class="even">
<td>JobInvolvement</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td>JobLevel</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td>JobRole</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td>JobSatisfaction</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td>MaritalStatus</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td>MonthlyIncome</td>
<td align="right">826</td>
</tr>
<tr class="even">
<td>MonthlyRate</td>
<td align="right">852</td>
</tr>
<tr class="odd">
<td>NumCompaniesWorked</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td>Over18</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td>OverTime</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td>PercentSalaryHike</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td>PerformanceRating</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td>RelationshipSatisfaction</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td>StandardHours</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td>StockOptionLevel</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td>TotalWorkingYears</td>
<td align="right">39</td>
</tr>
<tr class="even">
<td>TrainingTimesLastYear</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td>WorkLifeBalance</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td>YearsAtCompany</td>
<td align="right">32</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#EmployeeCount, Over18, and StandardHours all only one unique value.
dffactors &lt;- dffactors[,sapply(dffactors, function(vals) length(unique(vals)))&gt;1]</code></pre>
<pre class="r"><code>#subset to collect names for all columns except jobrole
dfnumbers&lt;-colnames(dffactors %&gt;% select_if(is.numeric))
nojob&lt;-subset(dffactors, select = -c(JobRole))
dfothers&lt;- colnames(nojob %&gt;% select_if(negate(is.numeric)))



for (i in 1:length(dfnumbers)) {
  aggmeans &lt;- aggregate(get(dfnumbers[i])~JobRole, dffactors, mean)
  names(aggmeans)[2] &lt;- dfnumbers[i]
  
  plot&lt;-ggplot(aggmeans, aes(x = reorder(as.factor(get(colnames(aggmeans[1]))), -get(colnames(aggmeans[2]))), y = get(colnames(aggmeans[2])))) + 
    labs(y= colnames(aggmeans[2]), x = colnames(aggmeans[1])) + 
    geom_point() + 
    ggtitle(&#39;Mean Values by Job Role&#39;) + theme(plot.title = element_text(hjust = .5), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
  
  print(plot)
  
}</code></pre>
<p><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-1.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-2.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-3.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-4.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-5.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-6.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-7.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-8.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-9.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-10.png" width="672" /></p>
<pre class="r"><code>#Factor frequency counts per job role
for (i in 1:length(dfothers)) {
  
  unq&lt;-data.frame(with(dffactors, table(get(dfothers[i]), JobRole)))
  
  factorplot &lt;- ggplot(unq, aes(x = reorder(as.factor(get(colnames(unq[2]))), -get(colnames(unq[3]))), y = get(colnames(unq[3])), fill = Var1)) + 
    labs(y= colnames(unq[3]), x = colnames(unq[2]), fill= dfothers[i]) + 
    geom_bar(position= &quot;stack&quot; , stat=&quot;identity&quot;) + 
    ggtitle(&#39;Frequency of Factors by Job Role&#39;) + theme(plot.title = element_text(hjust = .5)) +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
  
  print(factorplot)
  
}</code></pre>
<p><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-11.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-12.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-13.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-14.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-15.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-16.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-17.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-18.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-19.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-20.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-21.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-22.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-23.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-24.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-25.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-26.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-27.png" width="672" /><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-6-28.png" width="672" /></p>
</div>
</div>
<div id="is-the-data-balanced" class="section level1">
<h1>Is the data balanced?</h1>
<div id="modeling-to-predict-attrition-needs-unbiased-data.-too-many-no-responses.-downsampled-to-fix." class="section level3">
<h3>Modeling to predict attrition needs unbiased data. Too many “no” responses. Downsampled to fix.</h3>
<pre class="r"><code>#check for uneven response variable
kable(table(dffactors$Attrition), col.names = c(&quot;Attrition&quot;, &quot;Total&quot;))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Attrition</th>
<th align="right">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">No</td>
<td align="right">730</td>
</tr>
<tr class="even">
<td align="left">Yes</td>
<td align="right">140</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#downsample to randomly give sample with same number of Yes/No
dflevels &lt;- dffactors[,factorcolumns]
dflevels$Attrition &lt;- dffactors$Attrition
dfNo&lt;- dflevels[which(dflevels$Attrition == &quot;No&quot;),]
dfYes&lt;- dflevels[which(dflevels$Attrition == &quot;Yes&quot;),]
downsamp&lt;-sample(seq(1:length(dfNo$Attrition)), length(dfYes$Attrition))
downsamp &lt;- dfNo[downsamp,]
downsamp &lt;- rbind(downsamp,dfYes)</code></pre>
</div>
</div>
<div id="find-the-best-randomization-seed-for-splitting-our-data-into-training-and-test-sets-and-set-the-seed." class="section level1">
<h1>Find the best randomization seed for splitting our data into training and test sets, and set the seed.</h1>
<pre class="r"><code>#find best seed for splitting into train and test set
cmloop &lt;- data.frame()
for (i in 1:100) {
  
  #set seed, take 70% sample and split the data set by the sample data (.7 train/.3 test).
  set.seed(i)
  trainIndicesloop &lt;- sample(seq(1:length(downsamp$Attrition)),round(.7*length(downsamp$Attrition)))
  traindfloop &lt;- downsamp[trainIndicesloop,]
  testdfloop &lt;- downsamp[-trainIndicesloop,]
  testdf2loop &lt;- subset(testdfloop, select = -c(Attrition))
  
  #NB training model
  trnattrloop = naiveBayes(Attrition~.,data = traindfloop)
  #predict attrition of test set
  nbpredattrloop&lt;-predict(trnattrloop,testdf2loop)
  #make a table of predictions vs actuals
  tblcmloop&lt;-table(nbpredattrloop,testdfloop$Attrition)
  #confusion matrix. columns are actual.
  CM7loop&lt;- caret::confusionMatrix(tblcmloop)
  CM7df1loop&lt;-data.frame(t(CM7loop$overall))
  accloop&lt;-CM7df1loop$Accuracy
  CM7df2loop&lt;-data.frame(t(CM7loop$byClass))
  sensloop&lt;-CM7df2loop$Sensitivity
  specifloop&lt;-CM7df2loop$Specificity
  #build a dataframe from each loop to indicate best seed for training/test split
  cmloop &lt;- rbind(cmloop, data.frame(accloop, sensloop, specifloop))
  
}

#build a df with the maxmeans
maxmeans &lt;- data.frame(Row = which.max(rowMeans(cmloop)))
maxmeans &lt;- cbind(maxmeans,cmloop[which.max(rowMeans(cmloop)),])

#What row had the highest mean of accuracy + sensitivity + specificity, and what were the values?
kable(maxmeans, col.names = c(&quot;Seed&quot;, &quot;Accuracy&quot;, &quot;Sensitivity&quot;, &quot;Specificity&quot;), row.names = F)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Seed</th>
<th align="right">Accuracy</th>
<th align="right">Sensitivity</th>
<th align="right">Specificity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">68</td>
<td align="right">0.8333333</td>
<td align="right">0.8717949</td>
<td align="right">0.8</td>
</tr>
</tbody>
</table>
</div>
<div id="run-the-model." class="section level1">
<h1>Run the model.</h1>
<div id="what-are-conditions-with-highest-probability-of-predicting-attrition-as-yes" class="section level3">
<h3>What are conditions with highest probability of predicting Attrition as “yes”?</h3>
</div>
<div id="accuracy-overall-percentage-of-correct-guesses." class="section level3">
<h3>Accuracy: overall percentage of correct guesses.</h3>
</div>
<div id="sensitivity-percentage-of-correct-no-responses." class="section level3">
<h3>Sensitivity: percentage of correct “No” responses.</h3>
</div>
<div id="specificity-percentage-of-correct-yes-responses." class="section level3">
<h3>Specificity: percentage of correct “Yes” responses.</h3>
</div>
<div id="prediction-table-helps-explain." class="section level3">
<h3>Prediction table helps explain.</h3>
<pre class="r"><code>#set seed to that row number, which is 68.
set.seed(which.max(rowMeans(cmloop)))

#split the data into training and test set. remove attrition from test set.
trainIndices &lt;- sample(seq(1:length(downsamp$Attrition)),round(.7*length(downsamp$Attrition)))
traindf &lt;- downsamp[trainIndices,]
testdf &lt;- downsamp[-trainIndices,]
testdf2 &lt;- subset(testdf, select = -c(Attrition))

#NB training model and prediction
nbmodel = naiveBayes(Attrition~.,data = traindf, type = &quot;raw&quot;)

#Use conditional probabilities to locate highest attrition factors
levelloop &lt;- data.frame()
for (i in 1:length(factorcolumns)) {
  
  df&lt;-data.frame(nbmodel$tables[i])
  Yes&lt;- df[which(df[1] == &quot;Yes&quot;),]
  Level&lt;- Yes[which(Yes[3] &gt; .2),]
  levelloop &lt;- rbind(levelloop, data.frame(Factor = factorcolumns[i],Level = Level[,2],Probability= Level[,3]))
}

#save our best 3 factors
Topfactors&lt;-tail(levelloop[order(levelloop$Probability),], 3)
kable(Topfactors, row.names = F)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Factor</th>
<th align="left">Level</th>
<th align="right">Probability</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">BusinessTravel</td>
<td align="left">Travel_Rarely</td>
<td align="right">0.6842105</td>
</tr>
<tr class="even">
<td align="left">StockOptionLevel</td>
<td align="left">0</td>
<td align="right">0.7157895</td>
</tr>
<tr class="odd">
<td align="left">PerformanceRating</td>
<td align="left">3</td>
<td align="right">0.8526316</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#make predictions
preds &lt;- predict(nbmodel, testdf2)

#find out how the model predictions compare to the test dataset actual values.
dfcm &lt;- caret::confusionMatrix(table(preds,testdf$Attrition))
#Accuracy = .833
#Sensitivity = .871
#Specificity = .8
#It did great!
kable(dfcm$table)</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">No</th>
<th align="right">Yes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>No</td>
<td align="right">34</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td>Yes</td>
<td align="right">5</td>
<td align="right">36</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#build a df with the maxmeans
dfcmtbl &lt;- data.frame(Accuracy = dfcm$overall[1])
dfcmtbl &lt;- cbind(dfcmtbl, Sensitivity = dfcm$byClass[1])
dfcmtbl &lt;- cbind(dfcmtbl, Specificity = dfcm$byClass[2])

#What were our prediction statistics?
kable(dfcmtbl, row.name = F)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Accuracy</th>
<th align="right">Sensitivity</th>
<th align="right">Specificity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.8333333</td>
<td align="right">0.8717949</td>
<td align="right">0.8</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="predicted-classifications" class="section level1">
<h1>Predicted Classifications</h1>
<pre class="r"><code>#read in the competition dataset, and wrangle it like our original data but keep the ID column.
compset &lt;- read.csv(&quot;CaseStudy2CompSet No Attrition.csv&quot;)

compsetresults &lt;- compset

compsetresults[,factorcolumns] &lt;- lapply(compset[,factorcolumns], as.factor)
compsetresults &lt;- compsetresults %&gt;% mutate_if(is.character,as.factor)

#run our model on the dataset, subset it to just IDs and Attrition, and write it to a csv file without rownames.
comppreds &lt;- predict(nbmodel, compsetresults)
compsetresults$Attrition &lt;- comppreds
compsetresults &lt;- subset(compsetresults, select = c(ID, Attrition))
write.csv(compsetresults, file = &quot;Case2PredictionsSherga Attrition.csv&quot;, row.names = F)</code></pre>
<pre class="r"><code>kable(head(compsetresults))</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">ID</th>
<th align="left">Attrition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1171</td>
<td align="left">No</td>
</tr>
<tr class="even">
<td align="right">1172</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="right">1173</td>
<td align="left">No</td>
</tr>
<tr class="even">
<td align="right">1174</td>
<td align="left">No</td>
</tr>
<tr class="odd">
<td align="right">1175</td>
<td align="left">No</td>
</tr>
<tr class="even">
<td align="right">1176</td>
<td align="left">No</td>
</tr>
</tbody>
</table>
</div>
<div id="percentage-distribution-of-results" class="section level1">
<h1>Percentage Distribution of Results</h1>
<pre class="r"><code>histogram(compsetresults$Attrition, xlab = &quot;Attrition Predictions&quot;, main = &quot;Classification Results&quot;,  col = &quot;green&quot;)</code></pre>
<p><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="monthly-income-linear-model." class="section level1">
<h1>Monthly Income linear model.</h1>
<div id="initial-model-analyses-flag-insignificant-variables-on-each-run-so-they-can-be-removed." class="section level3">
<h3>Initial model analyses flag insignificant variables on each run, so they can be removed.</h3>
</div>
<div id="final-analysis-shows-strong-significance-of-these-variables-as-predictors." class="section level3">
<h3>Final analysis shows strong significance of these variables as predictors.</h3>
<pre class="r"><code>#create a new downsampled dataset with a different seed and turn into train and test data.
set.seed(4)
dfNo2&lt;- dffactors[which(dffactors$Attrition == &quot;No&quot;),]
dfYes2&lt;- dffactors[which(dffactors$Attrition == &quot;Yes&quot;),]
downsamp2&lt;-sample(seq(1:length(dfNo2$Attrition)), length(dfYes2$Attrition))
downsamp2 &lt;- dfNo2[downsamp2,]
downsamp2 &lt;- rbind(downsamp2,dfYes2)

trainIndices2 &lt;- sample(seq(1:length(downsamp2$MonthlyIncome)),round(.7*length(downsamp2$MonthlyIncome)))
traindf2 &lt;- downsamp2[trainIndices,]
testdf2 &lt;- downsamp2[-trainIndices,]
testdf3 &lt;- subset(testdf2, select = -c(MonthlyIncome))


salarylm &lt;- lm(MonthlyIncome~., data = traindf2)

#ANOVA to find out which variables are significant in our model.
anva &lt;- anova(salarylm)
#only keep the variables that are 95% significant.
anva &lt;- anva[which(anva$`Pr(&gt;F)` &lt; .05),]
anva</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Response: MonthlyIncome
##                         Df     Sum Sq   Mean Sq  F value    Pr(&gt;F)    
## Age                      1  818358090 818358090 725.2557 &lt; 2.2e-16 ***
## Attrition                1   48400812  48400812  42.8944 1.443e-09 ***
## BusinessTravel           2   11281904   5640952   4.9992 0.0081896 ** 
## Department               2   90036470  45018235  39.8966 4.663e-14 ***
## Education                4   34249515   8562379   7.5883 1.710e-05 ***
## EducationField           5   47274674   9454935   8.3793 7.734e-07 ***
## EnvironmentSatisfaction  3   23583772   7861257   6.9669 0.0002293 ***
## Gender                   1   13643849  13643849  12.0916 0.0007025 ***
## JobInvolvement           3  116299280  38766427  34.3561 3.623e-16 ***
## JobLevel                 4 1923827019 480956755 426.2396 &lt; 2.2e-16 ***
## JobRole                  8  113855122  14231890  12.6128 4.423e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#list of significant variables, and include MonthlyIncome.
sigterms &lt;- tidy(anva)$term
sigterms[nrow(as.data.frame(sigterms)) + 1] &lt;- &quot;MonthlyIncome&quot;
salarylm &lt;- lm(MonthlyIncome~., data = traindf2[,sigterms])
anva &lt;- anova(salarylm)
anva &lt;- anva[which(anva$`Pr(&gt;F)` &lt; .05),]
anva</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Response: MonthlyIncome
##                         Df     Sum Sq   Mean Sq  F value    Pr(&gt;F)    
## Age                      1  818358090 818358090 709.9177 &lt; 2.2e-16 ***
## Attrition                1   48400812  48400812  41.9872 1.068e-09 ***
## BusinessTravel           2   11281904   5640952   4.8935 0.0086473 ** 
## Department               2   89914963  44957482  39.0002 1.543e-14 ***
## Education                4   34643268   8660817   7.5132 1.420e-05 ***
## EducationField           5   46104180   9220836   7.9990 9.293e-07 ***
## EnvironmentSatisfaction  3   27205804   9068601   7.8669 6.245e-05 ***
## Gender                   1   13831933  13831933  11.9991 0.0006821 ***
## JobInvolvement           3  118307357  39435786  34.2102 &lt; 2.2e-16 ***
## JobLevel                 4 1924154661 481038665 417.2963 &lt; 2.2e-16 ***
## JobRole                  8  104230699  13028837  11.3024 1.216e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>#all remaining variables are significant
#display all best predictors
predtbl&lt;-data.frame(Predictors = tidy(anva)$term)
predtbl$`P-Values` &lt;- anva$`Pr(&gt;F)`
kable(predtbl)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Predictors</th>
<th align="right">P-Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Age</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">Attrition</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">BusinessTravel</td>
<td align="right">0.0086473</td>
</tr>
<tr class="even">
<td align="left">Department</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">Education</td>
<td align="right">0.0000142</td>
</tr>
<tr class="even">
<td align="left">EducationField</td>
<td align="right">0.0000009</td>
</tr>
<tr class="odd">
<td align="left">EnvironmentSatisfaction</td>
<td align="right">0.0000625</td>
</tr>
<tr class="even">
<td align="left">Gender</td>
<td align="right">0.0006821</td>
</tr>
<tr class="odd">
<td align="left">JobInvolvement</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">JobLevel</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">JobRole</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="use-linear-model-to-make-prediction-on-test-set." class="section level1">
<h1>Use linear model to make prediction on test set.</h1>
<div id="rmse-tells-deviation-from-our-model-in-dollars." class="section level3">
<h3>RMSE tells deviation from our model in dollars.</h3>
</div>
<div id="here-we-can-see-the-rmse-when-the-model-is-run-on-our-test-training-and-full-datasets." class="section level3">
<h3>Here we can see the RMSE when the model is run on our test, training, and full datasets.</h3>
<pre class="r"><code>#use model to make prediction on our test set.
lmpreds &lt;- predict(salarylm, testdf3)
#calculate the error by finding the difference between predictions and actuals. then calculate the root mean square error.
err &lt;- lmpreds - testdf2$MonthlyIncome
RMSEdf &lt;- data.frame(Test_RMSE = sqrt(mean(err^2)))
#RMSE = $1200.833 monthly income

lmpredstrain &lt;- predict(salarylm, traindf2)
#calculate the error by finding the difference between predictions and actuals. then calculate the root mean square error.
errtrain &lt;- lmpredstrain - traindf2$MonthlyIncome
RMSEdf$Train_RMSE &lt;- sqrt(mean(errtrain^2))
#RMSE = $973.089 monthly income

lmpredfull &lt;- predict(salarylm, dffactors)
#calculate the error by finding the difference between predictions and actuals. then calculate the root mean square error.
errfull &lt;- lmpredfull - dffactors$MonthlyIncome
RMSEdf$Full_RMSE &lt;- sqrt(mean(errfull^2))
#RMSE = $1064.57 monthly income

kable(RMSEdf, col.names = c(&quot;Test RMSE&quot;, &quot;Train RMSE&quot;, &quot;Full RMSE&quot;))</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">Test RMSE</th>
<th align="right">Train RMSE</th>
<th align="right">Full RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1200.833</td>
<td align="right">973.0891</td>
<td align="right">1064.569</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="residual-plot" class="section level1">
<h1>Residual Plot</h1>
<div id="plot-predicted-values-vs-actual-to-observe-residuals-on-zero-line." class="section level3">
<h3>Plot predicted values vs actual to observe residuals on zero line.</h3>
</div>
<div id="random-scattering-on-both-sides-of-the-reference-line." class="section level3">
<h3>Random scattering on both sides of the reference line.</h3>
<pre class="r"><code>#plot model predictions compared to actuals, in order to see regression trend.
plot(lmpreds,testdf2$MonthlyIncome,
     xlab = &quot;Predicted Monthly Income&quot;,ylab = &quot;Actual Monthly Income&quot;, main = &quot;Linear Comparison of Predictions vs Actuals&quot;)
abline(a = 0, b = 1)</code></pre>
<p><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre class="r"><code>#plot model predictions compared to actuals, in order to see regression trend.
plot(lmpredstrain,traindf2$MonthlyIncome,
     xlab = &quot;Predicted Monthly Income&quot;,ylab = &quot;Actual Monthly Income&quot;, main = &quot;Linear Comparison of Predictions vs Actuals&quot;)
abline(a = 0, b = 1)</code></pre>
<p><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre class="r"><code>#plot model predictions compared to actuals, in order to see regression trend.
plot(lmpredfull,dffactors$MonthlyIncome,
     xlab = &quot;Predicted Monthly Income&quot;,ylab = &quot;Actual Monthly Income&quot;, main = &quot;Linear Comparison of Predictions vs Actuals&quot;)
abline(a = 0, b = 1)</code></pre>
<p><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
</div>
<div id="predicted-monthly-incomes" class="section level1">
<h1>Predicted Monthly Incomes</h1>
<pre class="r"><code>#read in the competition dataset, and wrangle it like our original data but keep the ID column.
salcompset &lt;- read_xlsx(&quot;CaseStudy2CompSet No Salary.xlsx&quot;)

salcompsetresults &lt;- salcompset

salcompsetresults[,factorcolumns] &lt;- lapply(salcompset[,factorcolumns], as.factor)
salcompsetresults &lt;- salcompsetresults %&gt;% mutate_if(is.character,as.factor)


#run our model on the dataset, subset it to just IDs and monthlyincome, and write it to a csv file without rownames.
salcomppreds &lt;- round(predict(salarylm, salcompsetresults), digits = 2)
salcompsetresults$MonthlyIncome &lt;- salcomppreds
salcompsetresults &lt;- subset(salcompsetresults, select = c(ID, MonthlyIncome))
write.csv(salcompsetresults, file = &quot;Case2PredictionsSherga Salary.csv&quot;, row.names = F)</code></pre>
<pre class="r"><code>kable(head(salcompsetresults))</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">ID</th>
<th align="right">MonthlyIncome</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">871</td>
<td align="right">6006.17</td>
</tr>
<tr class="even">
<td align="right">872</td>
<td align="right">2701.10</td>
</tr>
<tr class="odd">
<td align="right">873</td>
<td align="right">13049.47</td>
</tr>
<tr class="even">
<td align="right">874</td>
<td align="right">2757.69</td>
</tr>
<tr class="odd">
<td align="right">875</td>
<td align="right">2626.98</td>
</tr>
<tr class="even">
<td align="right">876</td>
<td align="right">4174.28</td>
</tr>
</tbody>
</table>
</div>
<div id="percentage-distribution-of-results-1" class="section level1">
<h1>Percentage Distribution of Results</h1>
<div id="similar-shape-to-downsampled-dataset." class="section level3">
<h3>Similar shape to downsampled dataset.</h3>
<pre class="r"><code>hist(salcompsetresults$MonthlyIncome, xlab = &quot;Monthly Income Predictions&quot;, main = &quot;Prediction Results&quot;,  col = &quot;green&quot;, prob = TRUE)
lines(density(salcompsetresults$MonthlyIncome, adjust = 2))</code></pre>
<p><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<pre class="r"><code>hist(downsamp2$MonthlyIncome, xlab = &quot;Source data&quot;, main = &quot;Downsampled Data Income&quot;,  col = &quot;green&quot;, prob = TRUE)
lines(density(downsamp2$MonthlyIncome))</code></pre>
<p><img src="casestudy2-htmlmkdwn_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
</div>
<div id="powerpoint-slides" class="section level1">
<h1>PowerPoint Slides</h1>
<p><img src="slideimages/Slide1.JPG" alt="Slide 1" /> <img src="slideimages/Slide2.JPG" alt="Slide 2" /> <img src="slideimages/Slide3.JPG" alt="Slide 3" /> <img src="slideimages/Slide4.JPG" alt="Slide 4" /> <img src="slideimages/Slide5.JPG" alt="Slide 5" /> <img src="slideimages/Slide6.JPG" alt="Slide 6" /> <img src="slideimages/Slide7.JPG" alt="Slide 7" /> <img src="slideimages/Slide8.JPG" alt="Slide 8" /> <img src="slideimages/Slide9.JPG" alt="Slide 9" /> <img src="slideimages/Slide10.JPG" alt="Slide 10" /></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
